<ion-content class="fondo" [fullscreen]="true">
  <div class="bienvenida-card">
    <h2>Bienvenido a <span class="sistema-title">{{ sistema }}</span></h2>
    <p>Â¡Completa tu registro y gana <b class="puntos-oro">10 puntos</b>!</p>
    <form (ngSubmit)="guardarRegistro()" autocomplete="off" class="form-una-col">

      <div class="col nombre-row">
        <label>Nombre</label>
        <input class="nombre-input" placeholder="Luis" type="text" [(ngModel)]="usuario.nombre_completo" name="nombre_completo" required>
      </div>

      <div class="col apellido-row">
        <label>Apellido</label>
        <input class="apellido-input" placeholder="LopÃ©z" type="text" [(ngModel)]="usuario.apellido_completo" name="apellido_completo" required>
      </div>

      <div class="col celular-row">
        <label>Celular</label>
        <div class="celular-input-group">
          <select [(ngModel)]="usuario.prefijo" name="prefijo" required class="celular-prefijo" (change)="onChangePrefijo()">
            <option value="+56">ðŸ‡¨ðŸ‡± +56 (Chile)</option>
            <option value="+51">ðŸ‡µðŸ‡ª +51 (PerÃº)</option>
          </select>
          <input
            type="tel"
            [(ngModel)]="usuario.celular"
            name="celular"
            required
            maxlength="9"
            placeholder="123456789"
            class="celular-input"
          />
        </div>
      </div>

      <div class="col documento-row">
        <label>Documento</label>
        <div class="documento-input-group">
          <select 
            class="documento-prefijo"
            [(ngModel)]="usuario.tipoDocumento"
            name="tipoDocumento"
            required
            (change)="resetDocumento()"
          >
            <option value="rut">RUT Chileno</option>
            <option value="dni">DNI Peruano</option>
            <option disabled>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</option>
            <option value="extranjero-cl">Extranjero (Chile)</option>
            <option value="extranjero-pe">Extranjero (PerÃº)</option>
          </select>
          <input 
            type="text"
            [(ngModel)]="usuario.numeroDocumento"
            name="numeroDocumento"
            required
            [attr.maxlength]="getMaxLength()"
            [pattern]="getPattern()"
            [placeholder]="getPlaceholder()"
            class="documento-input"
          />
        </div>
        <small *ngIf="usuario.tipoDocumento === 'rut'">RUT chileno: 12345678-9</small>
        <small *ngIf="usuario.tipoDocumento === 'dni'">DNI peruano: 12345678</small>        
        <small *ngIf="usuario.tipoDocumento && usuario.tipoDocumento.startsWith('extranjero')">
          Extranjeros: mÃ­nimo 4 caracteres
        </small>        
      </div>

      <div class="col nacimiento-row">
        <label>Fecha de nacimiento</label>
        <div class="fecha-select-group">
          <select [(ngModel)]="fechaSeleccionada.dia" name="dia" class="fecha-select" required>
            <option value="" disabled selected>DÃ­a</option>
            <option *ngFor="let d of diasDisponibles" [value]="d">{{ d }}</option>
          </select>
          <select [(ngModel)]="fechaSeleccionada.mes" name="mes" class="fecha-select" required>
            <option value="" disabled selected>Mes</option>
            <option *ngFor="let m of mesesDisponibles; let i = index" [value]="i+1">{{ m }}</option>
          </select>
          <select [(ngModel)]="fechaSeleccionada.anio" name="anio" class="fecha-select" required>
            <option value="" disabled selected>AÃ±o</option>
            <option *ngFor="let a of aniosDisponibles" [value]="a">{{ a }}</option>
          </select>
        </div>
        <small *ngIf="!fechaNacimientoValida && fechaSeleccionada.dia && fechaSeleccionada.mes && fechaSeleccionada.anio" style="color:#ffd700">
          Debes tener al menos 18 aÃ±os y mÃ¡ximo 100 aÃ±os
        </small>
      </div>
      

      <div class="col email-row">
        <label>Email</label>
        <input
          class="email-input"
          type="email"
          [(ngModel)]="usuario.email"
          name="email"
          required
          placeholder="ejemplo@email.com"
        />
      </div>

      <div class="col input-ocr-doc archivo-row">
        <label>Foto de tu documento</label>
        <input 
          type="file"
          accept="image/*"
          (change)="onFileChange($event)"
          required
          class="archivo-input"
        />
        <button 
          type="button"
          class="btn-ocr"
          [disabled]="!archivo"
          (click)="validarDocumentoPorFoto()"
        >Validar con foto</button>
        <div *ngIf="ocrText">
          <small><b>Texto reconocido:</b></small>
          <pre class="ocr-preview">{{ ocrText }}</pre>
        </div>
      </div>

      <div class="col col-btn">
        <button type="submit" class="guardar-btn">
          GUARDAR Y GANAR 10 PUNTOS
        </button>
      </div>
    </form>
  </div>
</ion-content>
