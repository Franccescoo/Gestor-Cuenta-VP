<ion-content class="fondo" [fullscreen]="true">
  <app-header-usuario></app-header-usuario>

  <!-- ‚úÖ CAT√ÅLOGO DE BENEFICIOS CON FILTROS DE NIVEL -->
  <div class="catalogo-beneficios" *ngIf="categorias?.length; else cargandoTpl">

    <!-- Header con t√≠tulo y filtros de nivel -->
    <div class="catalogo-header">
      <div class="header-left">
        <div class="trophy-icon">
          <ion-icon name="trophy"></ion-icon>
        </div>
        <div class="header-text">
          <h2>CAT√ÅLOGO DE BENEFICIOS</h2>
          <p>Elige un beneficio disponible seg√∫n tu nivel.</p>
          <!-- ‚úÖ Informaci√≥n del nivel del usuario -->
          <div class="user-level-info" *ngIf="nivelUsuario">
            <ion-chip color="warning" class="level-chip">
              <ion-icon name="medal"></ion-icon>
              <ion-label>Tu nivel: {{ nivelUsuario.toUpperCase() }}</ion-label>
            </ion-chip>
            <small class="level-description">
              Puedes acceder a beneficios de nivel {{ nivelUsuario.toUpperCase() }} e inferiores
            </small>
          </div>
        </div>
      </div>

      <!-- ‚úÖ Filtros de nivel como botones (todos los niveles) -->
      <div class="nivel-filters" *ngIf="categorias?.length">
        <button 
          *ngFor="let categoria of categorias; let i = index" 
          class="nivel-btn"
          [class.active]="nivelSeleccionado === categoria.id"
          [class.disabled]="categoria.nivel > getNivelUsuarioNum()"
          [class]="'nivel-' + categoria.nivel"
          (click)="filtrarPorNivel(categoria.id)">
          {{ categoria.nombre.toUpperCase() }}
          <span *ngIf="categoria.nivel > getNivelUsuarioNum()" class="lock-icon">üîí</span>
        </button>
      </div>
    </div>


    <!-- ‚úÖ Tabla de beneficios con dise√±o elegante -->
    <div class="tabla-wrap">
      <table class="beneficios-table">
        <thead>
          <tr>
            <th>NIVEL</th>
            <th>BENEFICIO</th>
            <th>DESCRIPCI√ìN</th>
            <th>ESTADO</th>
            <th>ACCI√ìN</th>
          </tr>
        </thead>

        <tbody>
          <!-- ‚úÖ Mostrar mensaje si no hay beneficios disponibles -->
          <tr *ngIf="categoriasFiltradas.length === 0" class="no-benefits-row">
            <td colspan="5" class="no-benefits-message">
              <div class="empty-state">
                <ion-icon name="lock-closed-outline"></ion-icon>
                <h4>No hay beneficios disponibles</h4>
                <p *ngIf="nivelUsuario">
                  Tu nivel actual es <strong>{{ nivelUsuario.toUpperCase() }}</strong>.
                  <br>
                  Sube de nivel para acceder a m√°s beneficios.
                </p>
                <p *ngIf="!nivelUsuario">
                  No se pudo determinar tu nivel de usuario.
                  <br>
                  Contacta al soporte para m√°s informaci√≥n.
                </p>
              </div>
            </td>
          </tr>

          <!-- ‚úÖ Mostrar todas las categor√≠as con restricciones -->
          <ng-container *ngFor="let cat of categoriasFiltradas">
            <!-- ‚úÖ Fila de informaci√≥n del nivel -->
            <tr class="nivel-info-row" [class.nivel-no-disponible]="cat.nivel > getNivelUsuarioNum()">
              <td>
                <span class="nivel-badge" 
                      [class]="'badge-' + cat.nombre.toLowerCase()"
                      [class.badge-disabled]="cat.nivel > getNivelUsuarioNum()">
                  {{ cat.nombre.toUpperCase() }}
                </span>
              </td>
              <td colspan="4" class="nivel-description">
                <span class="nivel-text">
                  {{ getNivelDescription(cat.nombre) }}
                </span>
                <span *ngIf="cat.nivel > getNivelUsuarioNum()" class="nivel-bloqueado">
                  üîí Nivel bloqueado - Necesitas {{ cat.nombre.toUpperCase() }} o superior
                </span>
              </td>
            </tr>

            <!-- ‚úÖ Beneficios del nivel -->
            <tr *ngFor="let b of cat.beneficios" 
                class="beneficio-row beneficio-proximo">
              <td>
                <span class="nivel-badge" 
                      [class]="'badge-' + cat.nombre.toLowerCase()"
                      [class.badge-disabled]="cat.nivel > getNivelUsuarioNum()">
                  {{ cat.nombre.toUpperCase() }}
                </span>
              </td>
              <td class="beneficio-nombre">{{ b.nombre }}</td>
              <td class="beneficio-descripcion">{{ b.descripcion || '‚Äî' }}</td>
              <td class="beneficio-estado">
                <!-- ‚úÖ Todos los beneficios como PR√ìXIMAMENTE -->
                <span class="estado-proximamente">PR√ìXIMAMENTE</span>
              </td>
              <td class="beneficio-accion">
                <!-- ‚úÖ Todos los beneficios con overlay PR√ìXIMAMENTE -->
                <div class="btn-proximo-overlay">
                  <span class="proximo-pill">
                    <ion-icon name="time-outline"></ion-icon>
                    PR√ìXIMAMENTE
                  </span>
                </div>
              </td>
            </tr>
          </ng-container>
        </tbody>
      </table>
    </div>
  </div>

  <ng-template #cargandoTpl>
    <div style="display:grid;place-items:center;padding:2rem">
      <ion-spinner name="crescent"></ion-spinner>
    </div>
  </ng-template>

  <app-footer></app-footer>
</ion-content>