<ion-content class="fondo" [fullscreen]="true">
  <app-header-usuario></app-header-usuario>

  <!-- TABLA BENEFICIOS (negro + dorado) -->
  <div class="tabla-beneficios" *ngIf="categorias?.length; else cargandoTpl">

    <div class="tabla-head v2" aria-labelledby="titulo-beneficios">
      <div class="left">
        <div class="medal">
          <ion-icon name="trophy-outline" aria-hidden="true"></ion-icon>
        </div>
        <div class="titles">
          <h2 id="titulo-beneficios">Catálogo de Beneficios</h2>
          <p>Elige un beneficio disponible según tu nivel.</p>
        </div>
      </div>

      <div class="right" *ngIf="categorias?.length">
        <div class="legend">
          <span class="pill" *ngFor="let c of categorias">{{ c.nombre }}</span>
        </div>
      </div>
    </div>


    <div class="tabla-wrap">
      <table class="tabla">
        <thead>
          <tr>
            <th>Nivel</th>
            <th>Beneficio</th>
            <th>Descripción</th>
            <th>Estado</th>
            <th>Acción</th>
          </tr>
        </thead>

        <tbody>
          <!-- Grupo por categoría -->
          <ng-container *ngFor="let cat of categorias">
            <!-- Fila cabecera de categoría (opcional) -->
            <tr>
              <td data-label="Nivel">
                <span class="chip-nivel">{{ cat.nombre }}</span>
              </td>
              <td data-label="Beneficio" colspan="4">
                <span class="muted">{{ cat.descripcion || '—' }}</span>
              </td>
            </tr>

            <!-- Beneficios de la categoría -->
            <tr *ngFor="let b of cat.beneficios">
              <td class="hide-desktop" data-label="Nivel">
                <span class="chip-nivel">{{ cat.nombre }}</span>
              </td>
              <td data-label="Beneficio">{{ b.nombre }}</td>
              <td data-label="Descripción">
                <span class="muted">{{ b.descripcion || '—' }}</span>
              </td>
              <td data-label="Estado">
                <span class="badge">Disponible</span>
              </td>
              <td data-label="Acción">
                <button class="btn-canjear" (click)="onCanjear(cat.id, b.id)">
                  <ion-icon name="sparkles-outline"></ion-icon>
                  Canjear
                </button>
              </td>

            </tr>
          </ng-container>
        </tbody>
      </table>
    </div>
  </div>

  <ng-template #cargandoTpl>
    <div style="display:grid;place-items:center;padding:2rem">
      <ion-spinner name="crescent"></ion-spinner>
    </div>
  </ng-template>

  <app-footer></app-footer>
</ion-content>