<!-- Header -->

<header>


  <div class="header-nav">
    <a href="/inicio">
  <div class="logo">
    <img src="/assets/prestige/logo.png" alt="Prestige" />
  </div>
</a>
  <!-- NAV DESKTOP (visible >= 993px) -->
  <nav class="nav-menu">
    <a href="/menu" class="nav-item">INICIO</a>
    <a href="/perfil" class="nav-item">PERFIL</a>
    <a href="/beneficios" class="nav-item">BENEFICIOS</a>
    <a href="/canjear-puntos" class="nav-item">CANJEAR PUNTOS</a>
    <a href="/historial-canjes" class="nav-item">HISTORIAL DE CANJES</a>
  </nav>

  <!-- ✅ Puntos y Nivel del Usuario -->
  <div class="user-info" *ngIf="userDashboard$ | async as dashboard">
    <div class="user-level" *ngIf="dashboard.nivel">
      <ion-icon name="medal-outline" class="level-icon"></ion-icon>
      <span class="level-text">{{ dashboard.nivel }}</span>
    </div>
    
    <div class="user-points">
      <div class="points-display">
        <ion-icon name="diamond-outline" class="points-icon"></ion-icon>
        <span class="points-value">{{ dashboard.puntos | number }}</span>
        <span class="points-label">pts</span>
      </div>
    </div>
  </div>

  <!-- ✅ Icono de Notificaciones con Badge -->
  <div class="notification-container" style="position: relative; margin-right: 20px;">
    <div class="notification-icon" (click)="toggleNotificationsModal()" style="position: relative; cursor: pointer;">
      <ion-icon name="notifications-outline" style="font-size: 28px; color: #fff;"></ion-icon>
      <ion-badge 
        *ngIf="(unreadCount$ | async) && (unreadCount$ | async)! > 0" 
        color="danger" 
        style="position: absolute; top: -5px; right: -10px; font-size: 12px;">
        {{ unreadCount$ | async }}
      </ion-badge>
    </div>

    <!-- ✅ Modal de Notificaciones -->
    <div class="notifications-modal" *ngIf="showNotificationsModal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Notificaciones</h3>
               <ion-button fill="clear" size="small" (click)="goToNotificationsPage()">
                 Historial
                 <ion-icon name="arrow-forward" slot="end"></ion-icon>
               </ion-button>
      </div>
      
      <div class="modal-content">
        <!-- Lista de notificaciones -->
        <div class="notification-item" 
             *ngFor="let notificacion of notifications; trackBy: trackByFn" 
             [class.unread]="!notificacion.leida"
             (click)="markNotificationAsRead(notificacion)">
          
          <div class="notification-icon">
            <ion-icon [name]="getNotificationIcon(notificacion.tipo)" 
                      [color]="getNotificationColor(notificacion.tipo)">
            </ion-icon>
          </div>
          
          <div class="notification-content">
            <div class="notification-header">
              <h4>{{ notificacion.titulo }}</h4>
              <span class="notification-time">{{ formatTime(notificacion.fechaCreacion) }}</span>
            </div>
            <p class="notification-message">{{ notificacion.mensaje }}</p>
            
            <div class="notification-footer">
              <ion-chip [color]="getNotificationColor(notificacion.tipo)" size="small">
                {{ notificacion.tipo }}
              </ion-chip>
              <ion-badge *ngIf="!notificacion.leida" color="danger" class="unread-badge">
                No leída
              </ion-badge>
            </div>
          </div>
        </div>
        
        <!-- Estado vacío -->
        <div class="empty-state" *ngIf="notifications.length === 0">
          <ion-icon name="notifications-off-outline"></ion-icon>
          <p>No tienes notificaciones</p>
        </div>
      </div>
    </div>
  </div>

  <div class="auth-section" (click)="goToLogin()">
    <span class="register">CERRAR SESIÓN</span>
    <ion-icon name="person" class="user-icon"></ion-icon>
  </div>

  <!-- Botón Hamburguesa (visible < 993px) -->
  <div class="hamburger" (click)="toggleMenu()">
    <ion-icon name="menu-outline"></ion-icon>
  </div>
</div>

<!-- Menú lateral fullscreen (MÓVIL) -->
<div class="mobile-menu" [class.open]="menuOpen">
  <div class="menu-header">
    <img src="/assets/prestige/logo.png" alt="Prestige" />
    <ion-icon name="close-outline" class="close-btn" (click)="closeMenu()"></ion-icon>
  </div>

  <nav class="menu-links">
    <a href="/menu" class="nav-item">INICIO</a>
    <a href="/perfil" class="nav-item">PERFIL</a>
    <a href="/beneficios" class="nav-item">BENEFICIOS</a>
    <a href="/canjear-puntos" class="nav-item">CANJEAR PUNTOS</a>
    <a href="/historial-canjes" class="nav-item">HISTORIAL DE CANJES</a>
    
    <!-- ✅ Información del Usuario en móvil -->
    <div class="nav-item user-info-mobile" *ngIf="userDashboard$ | async as dashboard">
      <div class="user-level-mobile" *ngIf="dashboard.nivel">
        <ion-icon name="medal-outline" class="level-icon"></ion-icon>
        <span>{{ dashboard.nivel }}</span>
      </div>
      <div class="user-points-mobile">
        <ion-icon name="diamond-outline" class="points-icon"></ion-icon>
        <span>{{ dashboard.puntos | number }} pts</span>
      </div>
    </div>
    
    <div class="nav-item" (click)="toggleNotificationsModal()" style="position: relative; cursor: pointer;">
      NOTIFICACIONES
      <ion-badge 
        *ngIf="(unreadCount$ | async) && (unreadCount$ | async)! > 0" 
        color="danger" 
        style="margin-left: 8px; font-size: 11px;">
        {{ unreadCount$ | async }}
      </ion-badge>
    </div>
  </nav>

    
  <div class="menu-login">
    <a  href="/iniciar-sesion"><h3>CERRAR SESIÒN</h3></a>
  </div>
  
</div>


</header>
